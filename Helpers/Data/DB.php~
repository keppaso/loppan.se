<?php
/* This class is a helper class for database access. contains a few useful functions for this website */
class DB {
	private $server = "localhost";
	private $table_name = "Xtream";
	private $username = "root";
	private $password = "rsklmn1o6";
	
	private $db_connection;
	
	function __destruct() {
		$this->close();
	}
	
	public function connect()
	{
		$this->db_connection = mysqli_connect($this->server, $this->username, $this->password, $this->table_name);
		// Check connection
		if (!$this->db_connection) {
			// maybe die() or exit() is wrong but for now go with it
  			die("Connection failed: " . mysqli_connect_error());
  			return false;
		}
		return true;
	}
	
	public function execute_query($sql) 
	{
		if (($this->db_connection != null) && mysqli_query($this->db_connection, $sql)) {
			return true;
		}
		return false;
	}
	
	public function close()
	{
		if ($db_connection != null)
			mysqli_close($db_connection);
	}
	
	/*
		Add a RegsiterModel to database
	*/
	public function add_registration($model)
	{
		return $this->execute_query("INSERT INTO Users (name, last_name, email, password, is_admin) "
											. "VALUES('" . $model->Name . "','" . $model->Lastname . "','" . $model->Email . "','"
											. $model->Password1 . "', 0);");
	}
	
	/*
		Check if email exists in database, returns true if true else false
	*/
	public function is_email_registered($email)
	{
		$sql = "SELECT * FROM Users WHERE email='" . $email . "';";
		$result = mysqli_query($this->db_connection, $sql);
		if (mysqli_num_rows($result) > 0) { return true; }
		return false;
	}
	
	/*
		Gets a RegisterModel from email if it exists in database or null
	*/
	public function get_model($email)
	{
		$sql = "SELECT * FROM Users WHERE email='" . $email . "';";
		$result = mysqli_query($this->db_connection, $sql);
		if (mysqli_num_rows($result) > 0)
		{
			while($row = mysqli_fetch_assoc($result))
			{
				$model = new RegisterModel();
				$model->Name = $row["name"];
				$model->Lastname = $row["last_name"];
				$model->Email = $row["email"];
				$model->Password1 = $row["password"];
				return $model;
			}
		}
		return null;
	}
}
?>